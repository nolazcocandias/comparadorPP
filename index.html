
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora PalletParking vs Tradicional</title>
    https://cdn.jsdelivr.net/npm/chart.js</script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        .container { max-width: 700px; margin: auto; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #0078D7; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        padding: 8px; margin-top: 5px; }
        button { margin-top: 15px; width: 100%; padding: 10px; background: #0078D7; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #005fa3; }
        .result { margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; }
        canvas { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Comparador de Costos</h2>
        <label for="pallets">Cantidad de pallets:</label>
        <input type="number" id="pallets" min="1" required>

        <label for="meses">Meses de permanencia:</label>
        <input type="number" id="meses" min="1" max="12" required>

        <button onclick="calcular()">Calcular</button>

        <div class="result" id="resultado"></div>
        <canvas id="costChart" width="400" height="200"></canvas>
    </div>

    <script>
        let ufValor = 37000; // Valor por defecto, se actualizará con API
        let chartInstance;

        // Obtener valor UF desde API
        fetch('https://mindicador.cl/api/uf')
            .then(response => response.json())
            .then(data => {
                ufValor = data.serie[0].valor;
                console.log("Valor UF actualizado:", ufValor);
            })
            .catch(error => console.error("Error al obtener UF:", error));

        function calcular() {
            const pallets = parseFloat(document.getElementById('pallets').value);
            const meses = parseFloat(document.getElementById('meses').value);

            if (isNaN(pallets) || isNaN(meses) || pallets <= 0 || meses <= 0) {
                document.getElementById('resultado').innerHTML = "<p style='color:red;'>Ingrese valores válidos.</p>";
                return;
            }

            // Parámetros del modelo
            const ufAlmacenajePP = 0.195; // UF por pallet por mes (PalletParking)
            const ufAlmacenajeTrad = 0.24; // UF por pallet por mes (Tradicional)
            const ufMovimiento = 0.115; // UF por movimiento (in/out)
            const tasaInicial = 0.09;   // 9% stock inicial
            const palletsPorM2 = 2.1;   // pallets por m²

            // Cálculos comunes
            const stockInicial = pallets * tasaInicial;
            const stockFinal = pallets;
            const almacenajePromedio = (stockInicial + stockFinal) / 2;

            // PalletParking
            const costoAlmacenajePP = almacenajePromedio * ufAlmacenajePP * meses;
            const costoMovimientosPP = pallets * ufMovimiento * 2;
            const costoTotalPP = costoAlmacenajePP + costoMovimientosPP;

            // Tradicional
            const costoAlmacenajeTrad = almacenajePromedio * ufAlmacenajeTrad * meses;
            const costoMovimientosTrad = pallets * ufMovimiento * 2;
            const costoTotalTrad = costoAlmacenajeTrad + costoMovimientosTrad;

            // Conversión a CLP
            const costoPP_CLP = costoTotalPP * ufValor;
            const costoTrad_CLP = costoTotalTrad * ufValor;
            const ahorroCLP = costoTrad_CLP - costoPP_CLP;
            const ahorroUF = costoTotalTrad - costoTotalPP;

            const areaM2 = pallets / palletsPorM2;

            // Mostrar resultados
            document.getElementById('resultado').innerHTML = `
                <h3>Resultados:</h3>
                <p><strong>Área requerida:</strong> ${areaM2.toFixed(2)} m²</p>
                <p><strong>PalletParking:</strong> ${costoTotalPP.toFixed(2)} UF (~$${costoPP_CLP.toLocaleString('es-CL')} CLP)</p>
                <p><strong>Tradicional:</strong> ${costoTotalTrad.toFixed(2)} UF (~$${costoTrad_CLP.toLocaleString('es-CL')} CLP)</p>
                <p><strong>Ahorro estimado:</strong> ${ahorroUF.toFixed(2)} UF (~$${ahorroCLP.toLocaleString('es-CL')} CLP)</p>
            `;

            // Gráfico con Chart.js
            const ctx = document.getElementById('costChart').getContext('2d');
            if (chartInstance) chartInstance.destroy(); // Eliminar gráfico anterior

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['PalletParking', 'Tradicional'],
                    datasets: [{
                        label: 'Costo en UF',
                        data: [costoTotalPP.toFixed(2), costoTotalTrad.toFixed(2)],
                        backgroundColor: ['#0078D7', '#FF5733']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Comparación de Costos (UF)'
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
